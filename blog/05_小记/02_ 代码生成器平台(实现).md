# 代码生成器共享平台  实现
## 代码生成器平台 1~5期编码实现 上
我觉得可以分为三个大的步骤：
1. 项目的初始化 30min
2. 手动制作代码生成器 1h
    - 准备一个初始工程文件
    - 定义一些概念
1. 利用工具制作代码生成器（假定源包已存在）1h
### 项目初始化
1. 导入依赖
    - 工具包 Hutool 实用的工具类
    - 动态代码模板 freemarker  负责代码生成的核心逻辑
    - 命令行框架 picocli 负责提供CLI式的访问方式
### 手动制作代码生成器（ACM）
1. 先确认哪些文件需要动态生成，哪些文件可以直接复制
2. 定义数据模型（动态文件需要的）即我们可以定制化的部分
3. 制作源包（静态文件 + 动态文件）
4. 测试一下FreeMarker是否可以正常工作 简单测试 + 自带的动态文件测试
5. 利用源包 + 数据模型 生成定制化的工程代码
6. 为这个逻辑提供命令行的访问方式

- **问题1**：文件路径问题 反斜杠与斜杠 以及 路径开头是否有/ 这些问题
- **问题2**：打成Jar包后，无法直接遍历Jar包中的文件了
- **问题3**：不能以文件的形式，访问Jar包中内容

## 代码生成器平台 1~5期编码实现 下
- BUG：源包在jar中，无法以文件的形式进行遍历，如果要实现类似的功能，会比较复杂，可能需要大改整个生成的逻辑，后期来做，这里还是还是不要将源包文件放入资源文件夹中！
- 验证：在构造器中抛出的运行时异常似乎没有什么错误信息报警
- 额外的功能：集成日志组件
```java
public DynamicGenerator(String templateRootDir) {  
    try {  
        this.configuration = initTemplateEngineConfig(templateRootDir);  
    } catch (IOException e) {  
        throw new RuntimeException(e);  
    }  
}
```
- 待梳理：file.getPath() --> D:/code/simple-pd-generator/simple-acm-generator/.sourcepkg/acm-template/src/main/java/com/pandaer/InputTemplate.java.ftl
    - 核心问题就是这个分隔符，什么时候是\ 什么时候是/
- ~~BUG:~~ 利用Jar执行生成的代码文件存在中文乱码 解决方式：修改JVM参数，以及终端的参数
### 代码生成器工厂（代码生成器制作工具） 编码实现
存在两个模块：
1. 源包制作模块
2. 代码生成模块
#### 第一阶段 跑通核心流程（假设源包制作模块完成）
- 完成代码生成模块
定义元信息配置文件作用：描述代码生成器长什么样的
元信息（极简版）（JSON文件作为载体）：
1. 基本信息 （代码生成器的名字，版本，作者，创建时间）
2. 源包相关的描述（即原始工程文件中，哪些是动态文件，哪些是静态文件）
3. 数据模型的描述
```json
{  
  "basicInfo": {  
    "name": "acm输入模版代码生成器",  
    "description": "一个简单的ACM输入模版生成器",  
    "version": "1.0.0",  
    "createTime": "2024-12-8"  
  },  
  "sourcePkg": {  
    "originProjectPath": "原始工程文件的目录",  
    "files": [  
      {  
        "originFileRelativePath": "原始文件路径（原始工程文件中的文件路径）",  
        "type": "static"  
      },  
      {  
        "originFileRelativePath": "原始文件路径（原始工程文件中的文件路径）",  
        "type": "dynamic",  
        "args": {  
          "replacement": "原始文件中需要替换的文本内容",  
          "key": "模型配置中的字段名"  
        }  
      }  
    ]  
  },  
  "dataModel": {  
    "fields": [  
      {  
        "name": "字段名",  
        "type": "字段类型Java中的类型，最好是全限定类型",  
        "description": "字段信息描述",  
        "abbr": "参数缩写",  
        "defaultValue": "默认值"  
      }  
    ]  
  }  
}
```
- files字段中的配置存在默认行为，没有配置的认为是静态文件
一个例子：
```json
{  
  "basicInfo": {  
    "name": "ACM输入模版代码生成器",  
    "description": "一个简单的ACM输入模版生成器",  
    "version": "1.0.0",  
    "createTime": "2024-12-8"  
  },  
  "sourcePkg": {  
    "originProjectPath": "D:/code/simple-pd-generator/origin-project-demos/acm-template",  
    "files": [  
      {  
        "originFileRelativePath": ".gitignore",  
        "type": "static"  
      },  
      {  
        "originFileRelativePath": "README.md",  
        "type": "static"  
      },  
      {  
        "originFileRelativePath": "pom.xml",  
        "type": "dynamic"  
      },  
      {  
        "originFileRelativePath": "src/main/java/com/pandaer/InputTemplate.java",  
        "type": "dynamic"  
      }  
    ]  
  },  
  "dataModel": {  
    "fields": [  
      {  
        "name": "author",  
        "type": "String",  
        "description": "作者",  
        "abbr": "a",  
        "defaultValue": "匿名作者"  
      },  
      {  
        "name": "loop",  
        "type": "boolean",  
        "description": "控制ACM输入模板中的循环部分的生成",  
        "abbr": "l",  
        "defaultValue": "true"  
      },  
      {  
        "name": "displayText",  
        "type": "String",  
        "description": "控制输出的文本信息",  
        "defaultValue": "输出："  
      }  
    ]  
  }  
}
```
- 配置文件，配置类创建完成
- 假设源包制作工具是已经完成的条件下，完成代码生成模块
- **验证**：模型属性的生成，与视频中的存在不一致的问题。
### 小结
- 实现了一个极简版本的制作工具，即假设源包制作模块已完成。
- 梳理的图如下：
![](images/代码生成器共享平台.png)
## 代码生成器共享平台实现 第5期
>『功能优化』

- 完善流程，即支持自动打包（如果存在Maven）🍃
- 可移植性优化 相对路径改为绝对路径 🍃
- 功能优化：生成比较完整的README.md文档 🍃
- 功能增强：脚本文件支持兼容Windows平台，Linux平台 🍃
- 生成精简版代码生成器 即 jar包，源包，脚本文件。🍃
- 扩展点：生成的代码生成器可以交给Git托管（待实现）
- 健壮性优化：参数校验，异常处理，故障恢复 我们这里直接针对元信息配置文件进行参数校验以及兜底 🍃
- 圈复杂度优化：下载插件，测试圈复杂度 🍃
- 可扩展性优化：我们关注功能可扩展性 🍃
    - 尽量少使用硬编码，少使用魔法值
    - 利用模板方法模式固定整个代码生成器工厂的生产步骤
### 问题
- 源包，脚本文件的生成路径上必须拼接出一个当前工作空间 优化点，如果是相对路径就拼上一个工作目录 通过元信息参数校验的时候，拼接了一个当前工作空间（已解决）
## 代码生成器共享平台实现 第6期
> 『配置能力增强』

### 基于实例分析出具体的功能
> 核心能力：从特定的需求抽象出通用的能力
1. 替换生成代码的包名 
   - **通用能力**：制作工具根据配置自动"挖坑",并生成对应的动态模板文件
2. 控制是否生成帖子相关的功能 
   - **通用能力**：通过一个参数控制多个相关文件的生成
3. 控制是否开启跨域 
   - **通用能力**：通过一个参数控制单个文件的生成
4. 自定义Knife4jConfig接口配置文档 
   - **通用能力**：通过一个参数控制是否开启配置，如果开启就需要用户输入额外的多个参数
5. 自定义MySQL配置信息
   - **通用能力**：定义一组隔离的配置参数
6. 控制是否开启Redis
   - **通用能力**：修改多个代码文件的内容 （已经实现）
7. 控制是否开启Elasticsearch
   - **通用能力**：通过一个参数控制代码内容的生成，以及文件的生成。
### 基于现状，给需求排序
> **代码生成器**目前的能力：根据模型参数修改代码文件的内容

1. 根据元信息配置，"自动挖坑"并生成对应的动态模板
2. 一个模型参数控制多个文件的生成
3. 一个模型参数控制某个文件的生成
4. 一组模型参数控制代码修改或者文件的生成
5. 一组模型参数控制代码修改或者文件的生成，以及一个额外的模型参数可以控制这一组模型参数的开启
根据功能的复杂程度，以及实现的难易程度**重新排序**
1. 一个模型参数控制某个文件的生成
2. 一个模型参数控制多个文件的生成
3. 一组模型参数控制代码修改或者文件的生成
4. 一组模型参数控制代码修改或者文件的生成，以及一个额外的模型参数可以控制这一组模型参数的开启
5. 根据元信息配置，"自动挖坑"并生成对应的动态模板

我们需要将需求分类，我们的制作工具分为两个大的模块，一个是源包制作模块，一个是代码生成模块。
- 源包制作模块主要负责**源包文件的生成**
- 代码生成模块主要的能力就是生成代码生成器相关的代码文件（基于代码生成器的源包 + 元信息配置）
上面的需求，前4个都是对代码生成器能力的增强，而代码生成器的能力与制作工具的代码生成模块有关，更加具体点，就是**代码生成器的源包 以及元信息配置文件中dataModel配置相关**。最后一个需求与制作工具的源包制作模块有关。
### 代码生成器的代码生成能力的增强
要提升代码生成器的代码生成能力，就需要修改**制作工具的源包**以及**元信息配置文件中的dataModel**
接下来我们就一个一个完成前4个需求。
如果要实现这四个需求，数据模型的能力就不在纯粹了。
1. 有的模型参数，只负责参与动态模板的运算生成定制化的文件。
2. 有的模型参数只负责原始工程文件的生成与否，
3. 有的模型参数既要参与动态模板的运算，也要控制原始工程文件的生成。
4. 甚至还有一类模型参数是直接控制另外一组模型参数的生成。
负责的能力多了，代码就会变得复杂起来了。我们在实现过程中应该尽可能保证单一职责原则。

1. 一个模型参数控制某个文件（特指原始工程文件）的生成 🍃 
2. 一个模型参数控制多个文件的生成 🍃
3. 一组模型参数控制代码修改或者文件的生成 🍃
4. 一组模型参数控制代码修改或者文件的生成，以及一个额外的模型参数可以控制这一组模型参数的开启 🍃
- BUG: 代码静态文件 从源包中复制到定制化代码文件中存在路径问题，需要处理 **暂时解决方案** 变成动态文件即可
- BUG：模型参数控制文件是否生成，不能与group同时使用！

## 代码生成器共享平台实现 第7期
### 需求列表
1. 挖坑基础流程实现 🍃
2. 工作空间的搭建 🍃
3. 支持分步（连续）制作（状态的存储）
4. 同时处理多个文件（同时对多个文件挖相同的坑）
5. 精简模板文件，如果是静态文件，就没有必要生成模板文件
6. **文件过滤**，有些文件没有必要生成到源包中
7. 文件分组增强 （每一次制作看做一次分组，并记录到元信息配置文件中）
8. 模型配置分组 支持一次挖多个坑
